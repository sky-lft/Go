select       aaid,       counter_id,       market,       currency,       sum_invest_amount_1d,       sum_realized_amount_1d,       sum_fee_amount_1d,       start_holding_value,       end_holding_value,       end_holding_value  +  sum_realized_amount_1d   as  sum_income,       start_holding_value +  sum_fee_amount_1d + sum_invest_amount_1d  as sum_cost,        end_holding_value as  holding_value,       start_holding_value +  sum_fee_amount_1d + sum_invest_amount_1d as hold_cost,       sum_fee_amount_1d as accumulated_cost,       sum_realized_amount_1d as realized_cash,       sum_invest_amount_1d +sum_fee_amount_1d  as invest_cost ,       position_side, underlying_counter_id               from (        select * from ( SELECT       a.aaid,       a.counter_id,       a.market,       a.currency,       b.sum_invest_amount_1d,       b.sum_realized_amount_1d,       b.sum_fee_amount_1d,       b.position_side,       a.underlying_counter_id,       sum(         CASE           WHEN a.dt = b.max_dt THEN a.holding_value           ELSE 0         END       ) AS end_holding_value,       sum(         CASE           WHEN b.min_dt = '2021-01-14' and a.dt = b.min_dt THEN a.holding_value             ELSE 0         END       ) AS start_holding_value      FROM       incr_holding_stock_profit_and_loss_analysis AS a       JOIN (         SELECT           aaid,           counter_id,           account_channel,           max(dt) AS max_dt,           min(dt) AS min_dt,           sum(case when dt = '2021-01-14' then  0 else invest_amount_1d end) AS sum_invest_amount_1d,           sum(case when dt = '2021-01-14' then  0 else realized_amount_1d end) AS sum_realized_amount_1d,           sum(case when dt = '2021-01-14' then  0 else fee_amount_1d end  ) AS sum_fee_amount_1d,     position_side         FROM           incr_holding_stock_profit_and_loss_analysis         WHERE           aaid =  20000136 and counter_id = 'WT/HK/19930' and position_side = 'LONG'  and account_channel = 'lb'     and dt <= '2022-01-15' and dt >= '2021-01-14'          GROUP BY           aaid,           counter_id,position_side       ) b ON a.aaid =  b.aaid       AND a.counter_id = b.counter_id AND a.position_side = b.position_side       AND (         a.dt = b.min_dt         OR a.dt = b.max_dt       )     GROUP BY       a.aaid,       a.counter_id,       a.market,b.position_side,       a.currency order by counter_id       ) as t )            as t2     order by (sum_income - sum_cost)  / sum_cost desc